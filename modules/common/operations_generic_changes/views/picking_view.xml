<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_picking_form_extension" model="ir.ui.view">
        <field name="name">Generic Extensions</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>
        <field name="arch" type="xml">
            <xpath expr="//div[hasclass('oe_button_box')]" position="inside">
                <button type="object"
                        name="action_view_invoice"
                        class="oe_stat_button,oe_highlight"
                        icon="fa-cubes"
                        invisible = "invoice_count == 0">

                    <field name="invoice_count" widget="statinfo" string="Invoice"/>
                </button>
            </xpath>

            <xpath expr="//field[@name='origin']" position="after">
                <field name="invoice_id" readonly="1" invisible = "invoice_count == 0"/>
            </xpath>

            <xpath expr="//field[@name='backorder_id']" position="after">
                <field name="customer_return_reference" invisible = "backorder_id == False"/>
            </xpath>

            <xpath expr="//field[@name='scheduled_date']" position="before">
                <field name="create_date" string="Creation Date"/>
            </xpath>

            <xpath expr="//button[@name='%(stock.act_stock_return_picking)d']" position="after">
                <button name="button_create_blank_return" string="Return Parts"
                        invisible="(picking_type_code == 'incoming' or state != 'done') or is_locked == False "
                        type="object" groups="base.group_user"/>
            </xpath>
        </field>
    </record>

    <!-- tree view -->
    <record id="stock_picking_tree" model="ir.ui.view">
        <field name="name">Generic Extensions</field>
        <field name="model">stock.picking</field>
        <field name="arch" type="xml">
            <list string="Picking list">
                <field name="name"/>
                <field name="location_dest_id"/>
                <field name="partner_id"/>
                <field name="create_date"/>
                <field name="scheduled_date"/>
                <field name="origin"/>
<!--                <field name="group_id" invisible="1"/>-->
                <field name="backorder_id"/>
                <field name="state"/>
                <field name="priority"/>
                <field name="picking_type_id"/>
            </list>
        </field>
    </record>

    <!-- Add Source partner ID in to Stock picking tree view -->
    <record id="view_picking_tree_inherited" model="ir.ui.view">
        <field name="name">stock.picking.tree</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="operations_generic_changes.stock_picking_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name='source_partner_id'/>
            </xpath>
        </field>
    </record>

    <!-- modified search view -->
    <record id="view_picking_search" model="ir.ui.view">
        <field name="name">stock.picking.search</field>
        <field name="model">stock.picking</field>
        <field name="arch" type="xml">
            <search string="Picking Lists">
                <field name="name" string="Picking List"
                       filter_domain="[
						'|',
							('name','ilike', self),
							('origin','ilike',self)
					]"/>
                <filter icon="fa-check" name="draft" string="Draft" domain="[('state','=','draft')]"
                        help="Draft Moves"/>
                <filter icon="fa-check" name="available" string="WIP"
                        domain="[
						('state','in', ('assigned', 'confirmed','waiting', 'draft'))
					]" help="Assigned Moves"/>
                <filter icon="fa-check" name="waiting" string="Waiting Availability"
                        domain="[('state','=', 'confirmed')]" help="Waiting Moves"/>
                <filter icon="fa-camera" name="confirmed" string="Confirmed"
                        domain="[('state','in', ('confirmed', 'waiting', 'assigned'))]" help="Confirmed Moves"/>

                <filter icon="fa-done_icon" name="done" string="Done"
                        domain="[('state','=','done')]" help="Pickings already processed"/>

                <separator/>
                <filter name="late" string="Late"
                        domain="[('scheduled_date','&lt;', time.strftime('%%Y-%%m-%%d %%H:%%M:%%S'))]"
                        help="Pickings that are late on scheduled time"/>
                <separator/>
                <filter name="backorder" string="Backorders"
                        domain="[('backorder_id','&lt;&gt;', False)]"
                        help="Remaining parts of picking partially processed"/>

                <field name="partner_id" filter_domain="[('partner_id','child_of',self)]"/>
                <field name="product_id"/>
                <field name="picking_type_id"/>
                <field name="picking_type_code"/>
<!--                <field name="group_id"/>-->
                <group>
                    <filter name="status" string="Status" icon="terp-stock_effects-object-colorize"
                            domain="[]" context="{'group_by':'state'}"/>
                    <filter name="order_date" string="Order Date" icon="terp-go-month"
                            domain="[]" context="{'group_by':'create_date'}"/>
                    <filter name="origin" string="Origin" domain="[]" context="{'group_by':'origin'}"/>
                    <filter name="picking_type" string="Picking Type"
                            domain="[]" context="{'group_by':'picking_type_id'}"/>
<!--                    <filter name="procurement_group" string="Procurement Group"-->
<!--                            domain="[]" context="{'group_by':'group_id'}"/>-->
                </group>
            </search>
        </field>
    </record>

    <!-- create actions -->
    <record id="action_picking_type_outbound" model="ir.actions.act_window">
        <field name="name">Delivery Orders</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">stock.picking</field>
        <field name="view_mode">list,form</field>
        <field name="view_id" ref="stock_picking_tree"/>
        <field name="context">{
            'search_default_picking_type_code': 'outgoing',
            'default_picking_type_code': 'outgoing',
            'search_default_available': 1,
            'Delivery_Orders': 1
            }
        </field>
        <field name="search_view_id" ref="view_picking_search"/>
    </record>

    <record id="action_picking_type_transfer" model="ir.actions.act_window">
        <field name="name">Transfers</field>
        <field name="res_model">stock.picking</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_mode">list,form</field>
        <field name="view_id" ref="stock_picking_tree"/>
        <field name="context">{
            'search_default_picking_type_code': 'internal',
            'default_picking_type_code': 'internal',
            'search_default_available': 1,
            'planned_picking': True
            }
        </field>
        <field name="search_view_id" ref="view_picking_search"/>
    </record>

    <record id="action_picking_type_inbound" model="ir.actions.act_window">
        <field name="name">Incoming Shipments</field>
        <field name="res_model">stock.picking</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_mode">list,form</field>
        <field name="view_id" ref="stock_picking_tree"/>
        <field name="context">{
            'search_default_picking_type_code': 'incoming',
            'default_picking_type_code': 'incoming',
            'search_default_available': 1,
            'Incoming_Shipments': 1
            }
        </field>
        <field name="search_view_id" ref="view_picking_search"/>
    </record>

    <record id="action_cancel_picking" model="ir.actions.server">
        <field name="name">Cancel Picking</field>
        <field name="model_id" ref="model_stock_picking"/>
        <field name="state">code</field>
        <field name="binding_model_id" ref="model_stock_picking"/>
        <field name="code">action=records.more_action_cancel()</field>
    </record>

    <!-- Delivery Orders Search View - Add WIP search view and shop id to the drop downs -->
    <record model="ir.ui.view" id="view_picking_internal_search">
        <field name="name">sales.invoice.process.stock.delivery.filter.inherit</field>
        <field name="model">stock.picking</field>
        <field name="type">search</field>
        <field name="inherit_id" ref="stock.view_picking_internal_search"/>
        <field name="arch" type="xml">
            <xpath expr="/search/filter[@name='available']" position="before">
                <filter icon="terp-stock" name="wip" string="WIP"
                        domain="['|',('state','=','assigned'),('state','=','confirmed')]"
                        help="WIP Delivery Orders"/>
            </xpath>
            <xpath expr="/search/group/filter[1]" position="after">
                <field name="sale_warehouse_id"/>
            </xpath>
        </field>
    </record>

    <menuitem id="menu_picking_outbound"
              action="action_picking_type_outbound"
              parent="stock.menu_stock_warehouse_mgmt"
              groups="stock.group_stock_user" sequence="1"/>
    <menuitem id="menu_picking_inbound"
              action="action_picking_type_inbound"
              parent="stock.menu_stock_warehouse_mgmt"
              groups="stock.group_stock_user" sequence="1"/>
    <menuitem id="menu_picking_transfer"
              action="action_picking_type_transfer"
              parent="stock.menu_stock_warehouse_mgmt"
              groups="stock.group_stock_user" sequence="1"/>

    <!-- Hide the base "Transfers" menu item -->
<!--    <record id="stock.menu_stock_transfers" model="ir.ui.menu">-->
<!--        <field name="group_ids" eval="[(5,)]"/>-->
<!--    </record>-->
    <record id="stock.menu_stock_transfers" model="ir.ui.menu">
        <field name="group_ids" eval="[(4, ref('base_generic_changes.group_base_hidden_menus'))]"/>
    </record>
</odoo>
