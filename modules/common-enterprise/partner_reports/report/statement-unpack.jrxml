<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="Partner Statement (unpack)" pageWidth="595" pageHeight="842" columnWidth="595" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" uuid="c46c463d-f039-4528-8ce9-7eeea73281a0">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<style name="Base" isDefault="true" fontName="Droid Sans" fontSize="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false"/>
	<parameter name="viaduct" class="nz.optimysme.viaduct.Viaduct"/>
	<parameter name="viaduct-report-ids" class="java.util.List">
		<parameterDescription><![CDATA[List of res.partner.statement ids]]></parameterDescription>
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="viaduct-directory" class="java.lang.String"/>
	<parameter name="all-partners" class="java.lang.Boolean">
		<defaultValueExpression><![CDATA[Boolean.TRUE]]></defaultValueExpression>
	</parameter>
	<parameter name="partner-ids" class="java.util.List"/>
	<queryString>
		<![CDATA[select
  distinct res_partner_statement_id,
  transaction_partner_id,
  sort_name,
  case
    when supplier then 'supplier'
    else 'customer'
  end as type
from res_partner_statement, res_partner_statement_lines, res_partner
where $X{IN, res_partner_statement.id, viaduct-report-ids}
and res_partner_statement_id = res_partner_statement.id
and
  (
    $P{all-partners}
    or
    ($X{IN, res_partner.id, partner-ids})
  )
and
  (
    (not groupdebtor and transaction_partner_id = res_partner.id)
    or
    (groupdebtor and parent_partner_id = res_partner.id)
  )
order by res_partner_statement_id, transaction_partner_id, sort_name, type]]>
	</queryString>
	<field name="res_partner_statement_id" class="java.lang.Integer"/>
	<field name="transaction_partner_id" class="java.lang.Integer"/>
	<field name="sort_name" class="java.lang.String"/>
	<field name="type" class="java.lang.String"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<detail>
		<band height="15" splitType="Stretch">
			<subreport runToBottom="true">
				<reportElement x="0" y="0" width="595" height="15" uuid="c27583d0-bc3b-448a-a4f0-e2a440a15427"/>
				<subreportParameter name="partner-id">
					<subreportParameterExpression><![CDATA[$F{transaction_partner_id}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="viaduct">
					<subreportParameterExpression><![CDATA[$P{viaduct}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="viaduct-directory">
					<subreportParameterExpression><![CDATA[$P{viaduct-directory}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="statement-id">
					<subreportParameterExpression><![CDATA[$F{res_partner_statement_id}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{viaduct-directory} + "/statement-" + $F{type} + ".jasper"]]></subreportExpression>
			</subreport>
		</band>
	</detail>
</jasperReport>
